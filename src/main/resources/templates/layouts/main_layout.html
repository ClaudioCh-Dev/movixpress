<!DOCTYPE html>
<html lang="es" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
  <head>
    <meta charset="utf-8" />
    <title>Panel Administrativo - MoviXpress</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/global.css}" />
    <link rel="stylesheet" th:href="@{/css/admin.css}" />
  </head>

  <body
    class="admin-body"
    data-mensaje="[[${mensaje}]]"
    data-tipo="[[${tipoMensaje}]]"
  >
    <!-- Loader -->
    <div id="loader-overlay">
      <div class="loader"></div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <a
          href="/"
          class="d-flex align-items-center mb-0 text-white text-decoration-none fs-4 fw-bold"
        >
          <img
            th:src="@{/images/movixpressfull-logo.svg}"
            alt="Logo MoviXpress"
            style="max-height: 40px"
            class="mb-2"
          />
        </a>
      </div>

      <div class="p-3">
        <a
          href="/usuario/perfil"
          class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none p-2"
        >
          <img
            th:src="@{${fotoUsuario}}"
            class="rounded-circle me-2"
            alt="Foto"
            width="32"
            height="32"
            onerror="this.onerror=null; this.src='/images/default-user.png'; return false;"
          />
          <span class="fs-6">Datos personales</span>
        </a>

        <ul class="nav nav-pills flex-column mb-auto mt-3">
          <!-- Administración con ícono desplegable -->
          <li th:if="${rolUsuario == 'ROLE_ADMIN'}">
            <a
              class="nav-link text-white d-flex justify-content-between align-items-center collapsed"
              data-bs-toggle="collapse"
              href="#adminSubmenu"
              role="button"
              aria-expanded="false"
              aria-controls="adminSubmenu"
            >
              <span><i class="bi bi-gear me-2"></i>Administración</span>
              <i class="bi bi-chevron-down"></i>
            </a>
            <div
              class="collapse ps-3"
              id="adminSubmenu"
              th:classappend="${#strings.contains(currentUri, '/usuarios') or #strings.contains(currentUri, '/monedas') or #strings.contains(currentUri, '/configuracion')} ? 'show'"
            >
              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                <li>
                  <a
                    href="/usuarios/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/usuarios')} ? 'active'"
                    ><i class="bi bi-people me-2"></i>Usuarios</a
                  >
                </li>
                <li>
                  <a
                    href="/monedas/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/monedas')} ? 'active'"
                    ><i class="bi bi-currency-exchange me-2"></i>Monedas</a
                  >
                </li>
                <li>
                  <a
                    href="/configuracion/"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/configuracion')} ? 'active'"
                    ><i class="bi bi-sliders me-2"></i>Configuración</a
                  >
                </li>
              </ul>
            </div>
          </li>

          <li>
            <a
              href="/clientes/listado"
              class="nav-link text-white"
              th:classappend="${#strings.contains(currentUri, '/clientes')} ? 'active'"
              ><i class="bi bi-person-lines-fill me-2"></i>Clientes</a
            >
          </li>
          <li>
            <a
              href="/documentos/listado"
              class="nav-link text-white"
              th:classappend="${#strings.contains(currentUri, '/documentos')} ? 'active'"
              ><i class="bi bi-file-earmark-text me-2"></i>Documentos</a
            >
          </li>

          <!-- Vehículos con ícono desplegable -->
          <li>
            <a
              class="nav-link text-white d-flex justify-content-between align-items-center collapsed"
              data-bs-toggle="collapse"
              href="#vehiculosSubmenu"
              role="button"
              aria-expanded="false"
              aria-controls="vehiculosSubmenu"
            >
              <span><i class="bi bi-truck-front me-2"></i>Vehículos</span>
              <i class="bi bi-chevron-down"></i>
            </a>
            <div
              class="collapse ps-3"
              id="vehiculosSubmenu"
              th:classappend="${#strings.contains(currentUri, '/marcas') 
										or #strings.contains(currentUri, '/tipos')
										or #strings.contains(currentUri, '/combustibles')
										or #strings.contains(currentUri, '/transmisiones')
										or #strings.contains(currentUri, '/capacidades')
										or #strings.contains(currentUri, '/kilometrajes')
										or #strings.contains(currentUri, '/vehiculos')} ? 'show'"
            >
              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                <li>
                  <a
                    href="/marcas/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/marcas')} ? 'active'"
                  >
                    <i class="bi bi-badge-ad me-2"></i>Marcas
                  </a>
                </li>

                <li>
                  <a
                    href="/tipos/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/tipos')} ? 'active'"
                  >
                    <i class="bi bi-tags me-2"></i>Tipos
                  </a>
                </li>

                <li>
                  <a
                    href="/combustibles/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/combustibles')} ? 'active'"
                  >
                    <i class="bi bi-fuel-pump me-2"></i>Combustibles
                  </a>
                </li>

                <li>
                  <a
                    href="/transmisiones/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/transmisiones')} ? 'active'"
                  >
                    <i class="bi bi-gear-wide-connected me-2"></i>Transmisiones
                  </a>
                </li>

                <li>
                  <a
                    href="/capacidades/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/capacidades')} ? 'active'"
                  >
                    <i class="bi bi-people me-2"></i>Capacidades
                  </a>
                </li>

                <li>
                  <a
                    href="/kilometrajes/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/kilometrajes')} ? 'active'"
                  >
                    <i class="bi bi-speedometer2 me-2"></i>Kilometrajes
                  </a>
                </li>
                <li>
                  <a
                    href="/vehiculos/listado"
                    class="nav-link text-white"
                    th:classappend="${#strings.contains(currentUri, '/vehiculos')} ? 'active'"
                  >
                    <i class="bi bi-car-front me-2"></i>Vehículos
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <li>
            <a
              href="/alquiler/listado"
              class="nav-link text-white"
              th:classappend="${#strings.contains(currentUri, '/alquiler')} ? 'active'"
              ><i class="bi bi-calendar-check me-2"></i>Alquiler de Vehículos</a
            >
          </li>
          <li>
            <a href="#" class="nav-link text-white"
              ><i class="bi bi-clipboard-data me-2"></i>Reporte Préstamo</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="main-content">
      <!-- Top Header -->
      <header
        class="top-header d-flex justify-content-between align-items-center"
      >
        <h5 class="m-0 text-secondary fw-bold">Panel de Control</h5>

        <div class="d-flex align-items-center gap-3">
          <div class="dropdown text-end">
            <a
              href="#"
              class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle"
              id="dropdownUser1"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <span class="badge badge-online me-2">● En línea</span>

              <img
                th:src="@{${fotoUsuario}}"
                class="header-user-img me-2"
                onerror="this.src='/images/default-user.png';"
              />
            </a>
            <ul
              class="dropdown-menu dropdown-menu-dark text-small"
              aria-labelledby="dropdownUser1"
            >
              <li>
                <a class="dropdown-item" href="/usuario/perfil">Mi Perfil</a>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  onclick="document.getElementById('logoutForm').submit(); return false;"
                >
                  Cerrar sesión
                </a>
                <form
                  id="logoutForm"
                  th:action="@{/logout}"
                  method="post"
                  style="display: none"
                ></form>
              </li>
            </ul>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="container-fluid p-4" layout:fragment="content"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="/js/global/loader.js" defer></script>
    <script src="/js/global/navigation-loader.js" defer></script>
    <script src="/js/global/sweetalert-mensajes.js" defer></script>
    <script src="/js/global/sweet-alert-confirmation.js" defer></script>
    <script src="/js/global/sidebar-toggle.js" defer></script>
  </body>
</html>
