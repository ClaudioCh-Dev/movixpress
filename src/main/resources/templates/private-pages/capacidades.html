<!DOCTYPE html>
<html
  lang="es"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/main_layout.html}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Gestión de Capacidades</title>
  </head>

  <body class="bg-light">
    <div class="container mt-5" layout:fragment="content">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1
            th:text="${vista == 'activas'} ? 'Gestión de Capacidades' : 'Capacidades Eliminadas'"
            class="h4 card-title mb-4"
          ></h1>

          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#modalRegistro"
            th:attr="disabled=${vista == 'canceladas'} ? 'disabled' : null"
          >
            Registrar Capacidad
          </button>

          <a
            th:if="${vista == 'activas'}"
            th:href="@{/capacidades/cancelados}"
            class="btn btn-outline-secondary"
            >Ver Canceladas</a
          >
          <a
            th:if="${vista == 'canceladas'}"
            th:href="@{/capacidades/listado}"
            class="btn btn-outline-secondary"
            >Volver al Listado</a
          >

          <br /><br />

          <!-- Registrar -->
          <div class="modal fade" id="modalRegistro">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title">Registrar Capacidad</h5>
                  <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                  ></button>
                </div>

                <div class="modal-body">
                  <form
                    action="/capacidades/registro"
                    method="post"
                    th:object="${capacidad}"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />

                    <label class="form-label"
                      >Capacidad (Número de pasajeros)</label
                    >
                    <input
                      type="number"
                      min="1"
                      class="form-control"
                      th:field="*{cantidad}"
                      id="inputCantidad"
                    />

                    <div class="modal-footer">
                      <button
                        type="submit"
                        class="btn btn-primary"
                        id="btnRegistrar"
                        disabled
                      >
                        Registrar
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Cancelar
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Editar -->
          <div class="modal fade" id="modalEditar">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header bg-warning">
                  <h5 class="modal-title">Editar Capacidad</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>

                <div class="modal-body">
                  <form action="/capacidades/editar" method="post">
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <input type="hidden" name="id" id="editId" />

                    <label class="form-label">Capacidad</label>
                    <input
                      type="number"
                      min="1"
                      class="form-control"
                      name="cantidad"
                      id="editCantidad"
                    />

                    <div class="modal-footer">
                      <button type="submit" class="btn btn-warning">
                        Guardar
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Cancelar
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Mensaje -->
          <div
            th:if="${css_mensaje != null}"
            th:class="${css_mensaje}"
            th:text="${mensaje}"
            class="mt-3"
          ></div>

          <!-- Tabla -->
          <div class="table-responsive mt-4">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Capacidad</th>
                  <th>Acciones</th>
                </tr>
              </thead>

              <tbody>
                <tr th:if="${#lists.isEmpty(lstCapacidades)}">
                  <td colspan="3" class="text-center text-muted py-3">
                    No hay registros
                  </td>
                </tr>

                <tr th:each="c : ${lstCapacidades}">
                  <td th:text="${c.id}"></td>
                  <td th:text="${c.cantidad}"></td>

                  <td>
                    <!-- Editar -->
                    <button
                      th:if="${vista == 'activas'}"
                      type="button"
                      class="btn btn-sm btn-primary"
                      data-bs-toggle="modal"
                      data-bs-target="#modalEditar"
                      th:attr="data-id=${c.id}, data-cantidad=${c.cantidad}"
                    >
                      <i class="bi bi-pencil-square"></i>
                    </button>

                    <!-- Eliminar -->
                    <a
                      th:if="${vista == 'activas'}"
                      href="#"
                      class="btn btn-sm btn-danger btn-eliminar"
                      th:attr="data-id=${c.id}"
                    >
                      <i class="bi bi-trash"></i>
                    </a>
                    <form
                      th:action="@{/capacidades/eliminar/{id}(id=${c.id})}"
                      th:id="'formEliminar-'+${c.id}"
                      method="post"
                      style="display: none"
                    >
                      <input
                        type="hidden"
                        name="_csrf"
                        th:value="${_csrf.token}"
                      />
                    </form>

                    <!-- Restaurar -->
                    <a
                      th:if="${vista == 'canceladas'}"
                      th:href="@{/capacidades/restaurar/{id}(id=${c.id})}"
                      class="btn btn-sm btn-success"
                    >
                      <i class="bi bi-arrow-clockwise"></i>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <script>
        const inputCantidad = document.getElementById("inputCantidad");
        const btnRegistrar = document.getElementById("btnRegistrar");

        function validar() {
          btnRegistrar.disabled = !(
            inputCantidad.value && inputCantidad.value > 0
          );
        }
        inputCantidad.addEventListener("input", validar);
        validar();

        document
          .querySelectorAll('button[data-bs-target="#modalEditar"]')
          .forEach((btn) => {
            btn.addEventListener("click", () => {
              document.getElementById("editId").value = btn.dataset.id;
              document.getElementById("editCantidad").value =
                btn.dataset.cantidad;
            });
          });

        document.querySelectorAll(".btn-eliminar").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.id;
            document.getElementById("formEliminar-" + id).submit();
          });
        });
      </script>
    </div>
  </body>
</html>
